<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" media="all" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700|Oswald|Source+Code+Pro" />
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='screen.css') }}"/>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='overlay/iosOverlay.css') }}"/>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='overlay/prettify.css') }}"/>
  <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='lib/layout/layout-default-1.4.0.css') }}" />
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='user.css') }}"/>

  <script type="text/javascript" src="{{ url_for('static', filename='overlay/iosOverlay.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='overlay/spin.min.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='overlay/prettify.js') }}"></script>
  
  <script type="text/javascript" src="{{ url_for('static', filename='jquery-1.11.1.min.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='lib/jquery.ui.js') }}"></script>
  {% block head %}{% endblock %}
</head>


<body{% block bodyargs %}{% endblock %}>
  <div class="metanav">
    <div class="metanav_left">
      <ul class="menu">
        <li><a href="{{ url_for('knowrob') }}" style="padding-left: 0px;">Knowledge Base</a></li>
        <li><a href="{{ url_for('editor') }}">Editor</a></li>
        {% block menu %}{% endblock %}
        <li><a>Help</a><ul>
          <li><a href="{{ url_for('log') }}">Log</a></li>
        </ul></li>
      </ul>
    </div>
    <div class="metanav_right">
      {% if not current_user.is_authenticated() %}
	<a href="{{ url_for('user.login') }}">log in</a>
      {% else %}
        <ul class="menu" style="float: right;">
          <li><a id="exp-value">Experiment</a><ul id="exp-menu"></ul></li>
          <li><a href="{{ url_for('user.logout') }}">Logout {{ current_user.username }}</a></li>
        </ul>
      {% endif %}
    </div>
  </div>
  
  <div class="container" id="container" style="padding-left:15px; margin-top: 9px;">
    {% block content %}{% endblock %}
  
    <div class="pane ui-layout-south">
      {% with messages = get_flashed_messages() %}
	{% if messages %}
	    <ul class=flashes>
	    {% for message in messages %}
	      <li>{{ message }}</li>
	    {% endfor %}
	    </ul>
	{% endif %}
      {% endwith %}
    </div>
  </div>

  {% block spinner %}{% endblock %}
  
  <script type="text/javascript">
    function set_exp(exp) {
      $.ajax({
         url: "/exp_set",
         type: "POST",
         contentType: "application/json",
         data: JSON.stringify({
             experimentName: exp
         }),
         dataType: "json",
         success: function (data) {
             window.location.reload();
         }
       }).done( function (request) {});
    }
      
    $(document).ready(function () {
      // Request available experiments
      $.ajax({
          url: "/exp_list",
          type: "POST",
          contentType: "application/json",
          data: JSON.stringify({}),  
          dataType: "json",
          success: function (data) {
              $('#exp-menu').empty();
              $.each(data.result, function(j, exp) {
                  var li = document.createElement("li");
                  var item = document.createElement("a");
                  item.href = "#";
                  item.onclick = function() { set_exp(exp); };
                  item.appendChild(document.createTextNode(exp));
                  li.appendChild(item);
                  document.getElementById("exp-menu").appendChild(li);
              });
              if(data.selection) {
                document.getElementById("exp-value").innerHTML = data.selection;
              }
            }
      }).done( function (request) {})
    });
  </script>

</body>
</html>
